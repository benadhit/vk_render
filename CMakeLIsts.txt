cmake_minimum_required(VERSION 3.15)

project(hamon)

add_subdirectory(extern/glfw EXCLUDE_FROM_ALL)
add_subdirectory(extern/glm EXCLUDE_FROM_ALL)
message(STATUS $ENV{VULKAN_SDK})
message(STATUS ${CMAKE_ARCHIVE_OUTPUT_DIRECTORY})
# TODO regex
add_custom_target(build_shader
    COMMAND $ENV{VULKAN_SDK}/Bin/glslc shader.vert -o ${CMAKE_BINARY_DIR}/vert.spv
    COMMAND $ENV{VULKAN_SDK}/Bin/glslc shader.frag -o ${CMAKE_BINARY_DIR}/frag.spv
    WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/shaders
    COMMENT "Build GLSL Shader File To SPV"
)

add_executable(hamon 
    src/main.cpp
    src/Application.cpp
    src/VulkanUtils.cpp
    src/IoUtils.cpp
    src/Renderer.cpp
    )
add_dependencies(hamon build_shader)
target_link_libraries(hamon PRIVATE glfw glm)
target_include_directories(hamon PRIVATE ${CMAKE_SOURCE_DIR}/extern/glm)
if(MSVC)
target_compile_definitions(hamon PRIVATE VK_USE_PLATFORM_WIN32_KHR GLFW_EXPOSE_NATIVE_WIN32)
endif()
# set_target_properties(hamon PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR})